# ============================================================================
# ACI Backend Environment Configuration
# ============================================================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env file with secrets to version control
# ============================================================================

# ----------------------------------------------------------------------------
# Server Configuration
# ----------------------------------------------------------------------------
SERVER_PORT=8080

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
# PostgreSQL connection string
# Format: postgresql://username:password@hostname:port/database?sslmode=require
DATABASE_URL=postgresql://aci_user:your_password@localhost:5432/aci_db

# Connection Pool Settings (NEW - see Production Deployment Notes below)
# IMPORTANT: Ensure DB_MAX_CONNS × number_of_app_instances < PostgreSQL max_connections
# Default PostgreSQL max_connections = 100, leave 20 for admin connections
# Example: 3 app instances × 25 max_conns = 75 total + 20 admin = 95 (safe)
DB_MAX_CONNS=25           # Maximum number of connections in pool (default: 25)
DB_MIN_CONNS=5            # Minimum number of idle connections (default: 5)
DB_MAX_CONN_LIFETIME=1h   # Max lifetime of connection (default: 1h)
DB_MAX_CONN_IDLE_TIME=30m # Max idle time before connection closed (default: 30m)

# ----------------------------------------------------------------------------
# JWT Authentication
# ----------------------------------------------------------------------------
# Generate keys with:
#   openssl genrsa -out private.pem 2048
#   openssl rsa -in private.pem -pubout -out public.pem
JWT_PRIVATE_KEY_PATH=./keys/jwt-private.pem
JWT_PUBLIC_KEY_PATH=./keys/jwt-public.pem
JWT_ACCESS_TOKEN_EXPIRY=15m   # Access token lifetime (default: 15m)
JWT_REFRESH_TOKEN_EXPIRY=168h # Refresh token lifetime (default: 7 days)

# ----------------------------------------------------------------------------
# n8n Integration (REQUIRED for newsletter delivery)
# ----------------------------------------------------------------------------
# Webhook secret for validating incoming webhooks from n8n
N8N_WEBHOOK_SECRET=your-n8n-webhook-secret-here

# URL of your n8n instance webhook endpoint for newsletter delivery (NEW - REQUIRED)
# This is where the system will POST newsletter data for processing
N8N_WEBHOOK_URL=https://n8n.example.com/webhook/newsletter-delivery

# Timeout for n8n webhook requests in seconds (NEW)
# Increase this if you have large recipient lists or slow n8n processing
# Recommended: 30s for <1000 recipients, 60s for <5000 recipients
N8N_WEBHOOK_TIMEOUT_SECS=30

# ----------------------------------------------------------------------------
# AI Integration (REQUIRED)
# ----------------------------------------------------------------------------
# Anthropic Claude API key for AI-powered features
# Get your API key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=your-anthropic-api-key-here

# Timeout for AI API requests in seconds (NEW)
# Default: 60s for content generation, 30s for analysis
AI_TIMEOUT_SECS=60

# ----------------------------------------------------------------------------
# Newsletter Configuration (NEW)
# ----------------------------------------------------------------------------
# URL for webinar resources in follow-up emails
# Leave empty to use placeholder "#" (not recommended for production)
WEBINAR_RESOURCE_URL=https://www.example.com/webinars/resources

# ----------------------------------------------------------------------------
# Redis (OPTIONAL - for caching and session management)
# ----------------------------------------------------------------------------
# Redis connection string
# If not set, the application will work without caching
REDIS_URL=redis://localhost:6379/0

# ----------------------------------------------------------------------------
# Logging
# ----------------------------------------------------------------------------
# Log level: debug, info, warn, error
# Use "info" for production, "debug" for development
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# CORS Configuration (Optional)
# ----------------------------------------------------------------------------
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# ----------------------------------------------------------------------------
# Rate Limiting Configuration (Optional)
# ----------------------------------------------------------------------------
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=1m

# ============================================================================
# Production Deployment Notes
# ============================================================================
#
# CRITICAL: Before deploying to production, ensure:
#
# 1. Database Connection Pool Sizing:
#    - Check your PostgreSQL max_connections setting
#    - Calculate: app_instances × DB_MAX_CONNS < max_connections - 20
#    - Leave headroom for admin connections and monitoring tools
#
# 2. n8n Integration:
#    - N8N_WEBHOOK_SECRET must be a strong random value (32+ characters)
#    - N8N_WEBHOOK_URL must be accessible from your backend (REQUIRED)
#    - Test webhook connectivity before deploying
#    - Consider increasing N8N_WEBHOOK_TIMEOUT_SECS for large recipient lists
#
# 3. AI API:
#    - Verify ANTHROPIC_API_KEY has sufficient credits (REQUIRED)
#    - Monitor API usage to avoid rate limits
#    - Consider implementing circuit breaker for API failures
#
# 4. Security:
#    - Rotate JWT keys periodically
#    - Use environment-specific secrets (dev/staging/prod)
#    - Never commit .env file to version control
#    - Use secrets management (AWS Secrets Manager, HashiCorp Vault, etc.)
#
# 5. Performance:
#    - Monitor database connection pool usage
#    - Alert on connection pool exhaustion
#    - Monitor n8n webhook response times
#    - Set up Prometheus metrics for observability
#
# ============================================================================

{
  "name": "Password Reset Email",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "path": "password-reset",
        "httpMethod": "POST",
        "responseMode": "onReceived",
        "responseCode": 202,
        "options": {}
      },
      "id": "node1",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 380],
      "webhookId": "pw-reset-webhook",
      "notes": "Triggered by backend when user requests password reset. Expected payload: { email, token, reset_url, expires_at? }"
    },
    {
      "parameters": {
        "jsCode": "const body = items[0].json.body || items[0].json;\nif (!body.email) throw new Error('Missing email');\nif (!body.token) throw new Error('Missing token');\nif (!body.reset_url) throw new Error('Missing reset_url');\nreturn [{json: body}];"
      },
      "id": "node2",
      "name": "Validate",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 380],
      "notes": "Validates webhook payload has required fields and normalizes the data structure"
    },
    {
      "parameters": {
        "jsCode": "const item = items[0].json;\nconst resetUrl = item.reset_url;\nconst expiresAt = item.expires_at ? new Date(item.expires_at).toLocaleString() : 'in 1 hour';\n\nconst html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Reset Your Password - Armor Services</title>\n  <!--[if mso]>\n  <style type=\"text/css\">\n    body, table, td { font-family: Arial, sans-serif !important; }\n  </style>\n  <![endif]-->\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #0d0d0d; -webkit-font-smoothing: antialiased;\">\n  \n  <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #0d0d0d;\">\n    <tr>\n      <td style=\"padding: 48px 24px;\">\n        \n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"max-width: 448px; margin: 0 auto;\">\n          \n          <!-- Logo - Inline SVG -->\n          <tr>\n            <td style=\"padding-bottom: 32px;\">\n              <svg width=\"120\" height=\"51\" viewBox=\"0 0 264 112\" xmlns=\"http://www.w3.org/2000/svg\">\n                <g fill=\"#FFFFFF\" fill-rule=\"nonzero\">\n                  <path d=\"M120.750639,68.7681636 L115.383717,68.7681636 L115.383717,43.2011683 L120.79153,43.2011683 L131.004016,55.3764147 L131.004016,0 L0,0 L0,112 L131.004016,112 L131.004016,62.5527565 L120.750639,50.2241694 L120.750639,68.7681636 Z M50.2548375,61.6327127 L52.9229646,56.7155896 L56.9813801,56.7155896 L52.0438116,47.7809419 L40.4614823,68.7681636 L34.2767433,68.7681636 L48.9258854,43.2011683 L55.192406,43.2011683 L69.841548,68.7681636 L63.6568091,68.7681636 L59.7006207,61.6327127 L50.2548375,61.6327127 Z M99.4874042,68.7681636 L89.0295728,59.6290617 L89.0295728,54.5892662 L97.1464038,54.5892662 C99.9269806,54.5892662 101.337714,53.5158817 101.337714,51.3895582 C101.337714,49.2734575 99.9269806,48.1898503 97.1464038,48.1898503 L82.0167945,48.1898503 L82.0167945,68.7681636 L76.6498722,68.7681636 L76.6498722,43.2011683 L96.962395,43.2011683 C105.099671,43.2011683 106.806864,47.6582694 106.806864,51.3895582 C106.806864,58.003651 101.491055,59.3939394 97.033954,59.3939394 L96.5023731,59.3939394 L107.778021,68.7579409 L99.4874042,68.7579409 L99.4874042,68.7681636 Z\"/>\n                  <path d=\"M146.910551,50.2241694 L136.657174,62.5527565 L136.657174,112 L267.66119,112 L267.66119,0 L136.657174,0 L136.657174,55.3764147 L146.86966,43.2011683 L152.277474,43.2011683 L152.277474,68.7681636 L146.910551,68.7681636 L146.910551,50.2241694 Z M190.091274,65.4968967 C187.065352,68.0014604 182.628697,69.3201899 177.251552,69.3201899 C171.874407,69.3201899 167.427528,68.0014604 164.411829,65.4968967 C161.569916,63.1456736 160.056955,59.8539613 160.056955,55.9795546 C160.056955,52.1051479 161.559693,48.8236583 164.411829,46.4622125 C167.437751,43.9576488 171.874407,42.6389193 177.251552,42.6389193 C182.628697,42.6389193 187.075575,43.9576488 190.091274,46.4622125 C192.933187,48.8134356 194.446148,52.1051479 194.446148,55.9795546 C194.446148,59.8539613 192.94341,63.1456736 190.091274,65.4968967 Z M225.09383,68.7681636 L214.635999,59.6290617 L214.635999,54.5892662 L222.752829,54.5892662 C225.533406,54.5892662 226.94414,53.5158817 226.94414,51.3895582 C226.94414,49.2734575 225.533406,48.1898503 222.752829,48.1898503 L207.62322,48.1898503 L207.62322,68.7681636 L202.256298,68.7681636 L202.256298,43.2011683 L222.568821,43.2011683 C230.706097,43.2011683 232.41329,47.6582694 232.41329,51.3895582 C232.41329,58.003651 227.097481,59.3939394 222.64038,59.3939394 L222.108799,59.3939394 L233.384447,68.7579409 L225.09383,68.7579409 L225.09383,68.7681636 Z\"/>\n                  <path d=\"M177.251552,47.6480467 C169.809419,47.6480467 165.536327,50.6841913 165.536327,55.9897773 C165.536327,61.2851406 169.809419,64.3315078 177.251552,64.3315078 C184.693684,64.3315078 188.966776,61.2953633 188.966776,55.9897773 C188.966776,50.6841913 184.703907,47.6480467 177.251552,47.6480467 Z\"/>\n                </g>\n              </svg>\n            </td>\n          </tr>\n          \n          <!-- Card -->\n          <tr>\n            <td style=\"background-color: #1a1a1a; border: 1px solid #404040; border-radius: 8px;\">\n              \n              <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                <tr>\n                  <td style=\"padding: 32px;\">\n                    \n                    <!-- Heading -->\n                    <h2 style=\"margin: 0 0 8px 0; font-size: 30px; font-weight: 700; line-height: 1.2;\">\n                      <span style=\"color: #fafafa;\">Welcome to </span><span style=\"color: #f97316;\">Armor Services</span>\n                    </h2>\n                    \n                    <!-- Subtext -->\n                    <p style=\"margin: 0 0 24px 0; font-size: 14px; color: #a6a6a6; line-height: 1.5;\">\n                      Reset your password to access your security dashboard\n                    </p>\n                    \n                    <!-- Email context -->\n                    <p style=\"margin: 0 0 20px 0; font-size: 14px; color: #a6a6a6; line-height: 1.6;\">\n                      We received a request to reset your <span style=\"color: #fafafa; font-weight: 500;\">Armor Cyber News</span> password. Click the button below to create a new one.\n                    </p>\n                    \n                    <!-- Button -->\n                    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                      <tr>\n                        <td>\n                          <a href=\"${resetUrl}\" target=\"_blank\" style=\"display: block; width: 100%; padding: 14px 16px; background-color: #f97316; color: #fafafa; text-decoration: none; font-size: 14px; font-weight: 600; border-radius: 8px; text-align: center; box-sizing: border-box;\">\n                            Reset Password &rarr;\n                          </a>\n                        </td>\n                      </tr>\n                    </table>\n                    \n                    <!-- Expiration -->\n                    <p style=\"margin: 20px 0 0 0; font-size: 13px; color: #666666; line-height: 1.5;\">\n                      This link expires ${expiresAt}.\n                    </p>\n                    \n                    <!-- Divider -->\n                    <div style=\"height: 1px; background-color: #404040; margin: 24px 0;\"></div>\n                    \n                    <!-- Security notice -->\n                    <p style=\"margin: 0; font-size: 13px; color: #525252; line-height: 1.5;\">\n                      If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.\n                    </p>\n                    \n                  </td>\n                </tr>\n              </table>\n              \n            </td>\n          </tr>\n          \n          <!-- Footer -->\n          <tr>\n            <td style=\"padding-top: 24px; text-align: center;\">\n              \n              <!-- Security badge -->\n              <p style=\"margin: 0 0 12px 0; font-size: 12px; color: #666666;\">\n                &#128737; Enterprise-Grade Security\n              </p>\n              \n              <!-- Compliance badges -->\n              <p style=\"margin: 0 0 16px 0; font-size: 11px; color: #525252;\">\n                SOC 2 Type II &bull; PCI DSS Level 1 &bull; ISO 27001 &bull; HITRUST CSF\n              </p>\n              \n              <!-- Link -->\n              <p style=\"margin: 0 0 12px 0;\">\n                <a href=\"https://www.armor.com\" target=\"_blank\" style=\"font-size: 13px; font-weight: 500; color: #f59e0b; text-decoration: none;\">\n                  Visit Armor.com &nearr;\n                </a>\n              </p>\n              \n              <!-- Version -->\n              <p style=\"margin: 0; font-size: 11px; color: #525252; font-family: 'Geist Mono', ui-monospace, SFMono-Regular, monospace;\">\n                v1.7.230\n              </p>\n              \n            </td>\n          </tr>\n          \n        </table>\n        \n      </td>\n    </tr>\n  </table>\n  \n</body>\n</html>`;\n\nreturn [{json: {\n  to_email: item.email,\n  subject: 'Reset Your Password - Armor Services',\n  html_content: html,\n  from_name: 'Armor Services',\n  from_email: 'noreply@armor.com'\n}}];"
      },
      "id": "node3",
      "name": "Build Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [640, 380],
      "notes": "Builds the password reset email HTML with dark Armor Services branding"
    },
    {
      "parameters": {
        "jsCode": "const nodemailer = require('nodemailer');\nconst item = items[0].json;\n\nconst transporter = nodemailer.createTransport({\n  host: 'mailpit.armor-newsletter.svc.cluster.local',\n  port: 1025,\n  secure: false,\n  tls: { rejectUnauthorized: false }\n});\n\nconst info = await transporter.sendMail({\n  from: `\"${item.from_name}\" <${item.from_email}>`,\n  to: item.to_email,\n  subject: item.subject,\n  html: item.html_content\n});\n\nreturn [{ json: { success: true, messageId: info.messageId, to: item.to_email } }];"
      },
      "id": "node4",
      "name": "Send Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [840, 380],
      "notes": "Sends email via nodemailer (no n8n branding footer)"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "Validate", "type": "main", "index": 0 }]]
    },
    "Validate": {
      "main": [[{ "node": "Build Email", "type": "main", "index": 0 }]]
    },
    "Build Email": {
      "main": [[{ "node": "Send Email", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "staticData": null,
  "meta": { "templateCredsSetupCompleted": true },
  "pinData": {},
  "tags": [{ "id": "auth", "name": "Authentication" }]
}
